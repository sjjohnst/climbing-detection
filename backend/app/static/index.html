<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DTM viewer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>html,body,#map{height:100%;margin:0;padding:0}</style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    async function init() {
      const info = await fetch('/dtm_info').then(r => r.json());
      const center = info.center || [46.8, -71.4];
      const map = L.map('map').setView(center, 12);

      // Quebec aerial imagery WMS (as used in notebook/QGIS) - may require correct WMS endpoint parameters for your area.
      const quebecWms = L.tileLayer.wms(
        'https://servicesmatriciels.mern.gouv.qc.ca/erdas-iws/ogc/wms',
        {
          layers: 'Imagerie_Continue',
          format: 'image/png',
          transparent: false,
          attribution: 'Québec imagery'
        }
      ).addTo(map);

      // fallback base layer
      const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
      });

      L.control.layers({ 'Québec imagery (WMS)': quebecWms, 'OSM': osm }).addTo(map);

      // Add the DTM overlay image returned by backend
      if (info.image_url && info.bounds) {
        const imgUrl = info.image_url + '?t=' + Date.now();
        const bounds = info.bounds; // [[south, west], [north, east]]
        L.imageOverlay(imgUrl, bounds, { opacity: 0.7, interactive: false }).addTo(map);
        map.fitBounds(bounds);
      }
    }
    init();
  </script>
</body>
</html>
